<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ブログ閲覧</title>
    <link rel="stylesheet" href="blog.css">
    <link rel="stylesheet" href="dynamic.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <meta name="robots"
        content="noindex, nofollow, noarchive, nosnippet, max-image-preview:none, max-video-preview:0, noimageindex, unavailable-after:Thu, 24 Nov 2022 00:00:00 +0900">
</head>
<body>
    <div class="container">
        <header>
            <h1>ブログ</h1>
            <nav>
                <a href="index.html">ホーム</a>
                <a href="#" onclick="logout()">ログアウト</a>
            </nav>
        </header>
        
        <main>
            <div id="content-area">
                <div class="loading">読み込み中...</div>
            </div>
        </main>
    </div>
    
    <script type="module">
        import { verifyAuth, clearAuthCookie } from './blogcert.js';
        import { loadBlogPost, loadMainContent } from './blogloader.js';
        
        window.logout = function() {
            clearAuthCookie();
            window.location.href = 'index.html';
        };
        
        async function initPage() {
            const contentArea = document.getElementById('content-area');
            
            if (!await verifyAuth()) {
                contentArea.innerHTML = `
                    <div class="auth-required">
                        <h2>認証が必要です</h2>
                        <p>このページを閲覧するにはログインが必要です。</p>
                        <a href="login.html" class="btn-primary">ログインページへ</a>
                    </div>
                `;
                return;
            }
            
            const params = new URLSearchParams(window.location.search);
            const page = params.get('page');
            
            try {
                if (page) {
                    const content = await loadBlogPost(parseInt(page));
                    contentArea.innerHTML = content;
                } else {
                    const content = await loadMainContent();
                    contentArea.innerHTML = content;
                }
            } catch (error) {
                contentArea.innerHTML = `
                    <div class="error-message" style="display: block;">
                        <h2>エラー</h2>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        initPage();
    </script>
</body>
</html>